# Настройка мини-админки PVAdmin в MODX

## Обзор

Данное руководство описывает настройку мини-админки PVAdmin в MODX с использованием модульной системы Vue.js, Bootstrap и авторизации через MODX Login.

## Требования

- MODX Revolution 2.8+
- Дополнение pdoTools (для pdoMenu)
- Дополнение Login (для авторизации)
- Собранное Vue.js приложение PVAdmin

## Шаг 1: Создание шаблона

1. Перейдите в **Элементы → Шаблоны**
2. Создайте новый шаблон с именем **"PVAdmin"**
3. Скопируйте содержимое файла `core/components/pvadmin/elements/templates/admin.tpl`
4. Сохраните шаблон

## Шаг 2: Создание ресурса админки

1. Перейдите в **Ресурсы**
2. Создайте новый ресурс со следующими параметрами:
   - **Заголовок страницы**: "Админка"
   - **Псевдоним**: "admin"
   - **Шаблон**: "PVAdmin" (созданный на шаге 1)
   - **Опубликован**: Да
   - **Доступен для поиска**: Нет

## Шаг 3: Настройка прав доступа

1. Перейдите в **Безопасность → Группы ресурсов**
2. Создайте группу ресурсов "Admin" (если не существует)
3. Добавьте ресурс "admin" в эту группу
4. Настройте права доступа для нужных групп пользователей

## Шаг 4: Сборка Vue.js приложения

1. Выполните команду сборки:
   ```bash
   npm run build
   ```

2. Убедитесь, что файлы собраны в папку `dist/`:
   - `dist/assets/index.js`
   - `dist/assets/index.css`

## Шаг 5: Настройка путей к ресурсам

В шаблоне используются следующие пути к ресурсам Vue.js:
```html
<script type="module" src="/Extras/PVAdmin/dist/assets/index.js"></script>
<link rel="stylesheet" href="/Extras/PVAdmin/dist/assets/index.css">
```

Убедитесь, что пути соответствуют расположению вашего проекта.

## Шаг 6: Создание дочерних ресурсов (опционально)

Для демонстрации работы меню создайте дочерние ресурсы:

1. Создайте ресурс "Модуль 1" как дочерний для "admin"
2. Создайте ресурс "Модуль 2" как дочерний для "admin"
3. Установите для них тот же шаблон "PVAdmin"

## Функциональность

### Авторизация

- **Неавторизованные пользователи** видят форму входа с Bootstrap стилизацией
- **Авторизованные пользователи** видят навигационную панель и контент

### Навигация

- **Логотип PVAdmin** - ссылка на главную страницу
- **Меню "Модули"** - выпадающий список дочерних ресурсов (через pdoMenu)
- **Меню пользователя** - имя пользователя и кнопка выхода

### Контент

- **На главной странице админки** (`alias == 'admin'`) загружается Vue.js приложение PVAdmin
- **На дочерних страницах** отображается стандартный контент ресурса

### Модульная система

Vue.js приложение автоматически загружает модуль PVAdmin через конфигурацию:
```javascript
window.pvadminConfigs = {
    module: 'PVAdmin'
};
```

## Настройка системных параметров

### Страница для неавторизованных пользователей

Убедитесь, что в **Системные настройки → Аутентификация** установлена корректная страница для неавторизованных пользователей (`unauthorized_page`).

### Настройка Login

Сниппет Login настроен со следующими параметрами:
- `loginResourceId` - текущий ресурс админки
- `logoutResourceId` - страница для неавторизованных пользователей
- Кастомные шаблоны для формы входа и ошибок

## Стилизация

Используется Bootstrap 5.3.0 с дополнительными стилями:
- Градиентный фон для страницы входа
- Стилизованная карточка авторизации
- Адаптивная навигационная панель
- Bootstrap Icons для иконок

## Безопасность

- Доступ к админке контролируется через систему прав MODX
- Проверка авторизации на уровне шаблона
- Использование pdoMenu с параметром `checkPermissions => 'list'`

## Расширение функциональности

### Добавление новых модулей Vue.js

1. Создайте новый `.vue` файл в `src/modules/`
2. Выполните `npm run modules:update`
3. Пересоберите приложение `npm run build`

### Добавление новых страниц админки

1. Создайте новый ресурс как дочерний для "admin"
2. Установите шаблон "PVAdmin"
3. Настройте права доступа

### Кастомизация внешнего вида

Отредактируйте CSS стили в шаблоне или добавьте дополнительные стили в Vue.js компоненты.

## Устранение неполадок

### Проблемы с загрузкой Vue.js

1. Проверьте пути к файлам `dist/assets/`
2. Убедитесь, что файлы собраны корректно
3. Проверьте консоль браузера на наличие ошибок

### Проблемы с авторизацией

1. Убедитесь, что дополнение Login установлено и активно
2. Проверьте настройки `unauthorized_page`
3. Проверьте права доступа к ресурсу

### Проблемы с меню

1. Убедитесь, что pdoTools установлен
2. Проверьте права доступа к дочерним ресурсам
3. Убедитесь, что дочерние ресурсы опубликованы

## Заключение

Мини-админка PVAdmin предоставляет современный интерфейс для управления с использованием Vue.js модульной системы, интегрированной с MODX авторизацией и правами доступа.
